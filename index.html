<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Stories</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            padding: 16px;
            color: #333;
            overflow-x: hidden;
        }

        .category-section {
            margin-bottom: 24px;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .category-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .scroll-indicator {
            font-size: 12px;
            color: #7f8c8d;
        }

        .stories-carousel {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding-bottom: 8px;
            scrollbar-width: thin;
            scrollbar-color: #ddd transparent;
        }

        .stories-carousel::-webkit-scrollbar {
            height: 6px;
        }

        .stories-carousel::-webkit-scrollbar-track {
            background: transparent;
        }

        .stories-carousel::-webkit-scrollbar-thumb {
            background-color: #ddd;
            border-radius: 3px;
        }

        .story-card {
            flex: 0 0 140px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .story-card:hover {
            transform: translateY(-2px);
        }

        .story-image {
            width: 100%;
            height: 110px;
            object-fit: cover;
        }

        .story-info {
            padding: 8px;
        }

        .story-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            line-height: 1.2;
            color: #2c3e50;
        }

        .story-description {
            font-size: 11px;
            color: #7f8c8d;
            line-height: 1.3;
        }

        /* Audio player overlay */
        .audio-player-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .audio-player-overlay.hidden {
            transform: translateY(100%);
        }

        .mini-player {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .mini-cover {
            width: 48px;
            height: 48px;
            border-radius: 6px;
            object-fit: cover;
            margin-right: 12px;
        }

        .mini-info {
            flex: 1;
        }

        .mini-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 2px;
            color: #2c3e50;
        }

        .mini-category {
            font-size: 12px;
            color: #7f8c8d;
        }

        .mini-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mini-control-btn {
            background: none;
            border: none;
            color: #2c3e50;
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
        }

        .mini-control-btn:hover {
            color: #3498db;
        }

        .now-playing-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #27ae60;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <!-- Load stories data -->
    <script>
        // Sample stories data matching the JSON format
        const storiesData = [
            {
                "name": "قصص مجمعة",
                "stories": [
                    {
                        "id": 1,
                        "title": "نبيل العوضي - سلسلة قصص القرآن الكريم",
                        "description": " قصة البقرة وقصة هاروت وماروت",
                        "thumbnail": "https://raw.githubusercontent.com/ahmadhabchi81-cyber/QuranAppdzAPK/main/Sheik_%20Nabil_Al-Awadhi/channels4_profile.jpg",
                        "audioUrl": "https://github.com/ahmadhabchi81-cyber/QuranAppdzAPK/raw/main/Sheik_%20Nabil_Al-Awadhi/01.mp3"
                    },
                    {
                        "id": 2,
                        "title": "نبيل العوضي - سلسلة قصص القرآن الكريم ",
                        "description": " قصة طالوت وجالوت وقصة العزير",
                        "thumbnail": "https://raw.githubusercontent.com/ahmadhabchi81-cyber/QuranAppdzAPK/main/Sheik_%20Nabil_Al-Awadhi/channels4_profile.jpg",
                        "audioUrl": "https://github.com/ahmadhabchi81-cyber/QuranAppdzAPK/raw/main/Sheik_%20Nabil_Al-Awadhi/02.mp3"
                    },
                    {
                        "id": 3,
                        "title": "نبيل العوضي - سلسلة قصص القرآن الكريم ",
                        "description": "قصة ابني آدم وقصة أصحاب السبت",
                        "thumbnail": "https://raw.githubusercontent.com/ahmadhabchi81-cyber/QuranAppdzAPK/main/Sheik_%20Nabil_Al-Awadhi/channels4_profile.jpg",
                        "audioUrl": "https://github.com/ahmadhabchi81-cyber/QuranAppdzAPK/raw/main/Sheik_%20Nabil_Al-Awadhi/03.mp3"
                    }
                ]
            },
            {
                "name": "قصص الملائكة",
                "stories": [
                    {
                        "id": 4,
                        "title": "محمد بن عبد الرحمن العريفي",
                        "description": "ماذا تفعل الملائكة في عالمنا؟ | أسرار لا يعرفها الكثيرون ||.",
                        "thumbnail": "https://raw.githubusercontent.com/ahmadhabchi81-cyber/QuranAppdzAPK/main/Sheikh_Muhammad%20Al-Arifi/imop.jpg",
                        "audioUrl": "https://github.com/ahmadhabchi81-cyber/QuranAppdzAPK/raw/main/Sheikh_Muhammad Al-Arifi/03.mp3"
                    }
                   /** {
                        "id": 5,
                        "title": "The Lost Key",
                        "description": "An adventure story about discovery.",
                        "thumbnail": "https://picsum.photos/seed/key/300/200.jpg",
                        "audioUrl": "https://example.com/audio/key.mp3"
                    }**/
                ]
            }
        ];
    </script>

    <!-- Render categories dynamically -->
    <script>
        // Function to render story cards
        function renderStoryCard(story) {
            return `
                <div class="story-card" data-story-id="${story.id}" data-audio-url="${story.audioUrl}" data-title="${story.title}" data-thumbnail="${story.thumbnail}">
                    <img src="${story.thumbnail}" alt="${story.title}" class="story-image">
                    <div class="story-info">
                        <h3 class="story-title">${story.title}</h3>
                        <p class="story-description">${story.description}</p>
                    </div>
                </div>
            `;
        }

        // Function to render category section
        function renderCategorySection(category) {
            const storiesHtml = category.stories.map(renderStoryCard).join('');
            
            return `
                <div class="category-section">
                    <div class="category-header">
                        <h2 class="category-title">${category.name}</h2>
                        <span class="scroll-indicator">Swipe →</span>
                    </div>
                    <div class="stories-carousel" id="${category.name.toLowerCase().replace(/\s+/g, '-')}">
                        ${storiesHtml}
                    </div>
                </div>
            `;
        }

        // Render all categories
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.body;
            const categoriesHtml = storiesData.map(renderCategorySection).join('');
            container.insertAdjacentHTML('afterbegin', categoriesHtml);
            
            // Add click handlers to story cards
            document.querySelectorAll('.story-card').forEach(card => {
                card.addEventListener('click', () => {
                    const storyId = card.dataset.storyId;
                    const audioUrl = card.dataset.audioUrl;
                    const title = card.dataset.title;
                    const thumbnail = card.dataset.thumbnail;
                    
                    // Navigate to player page with story details
                    window.location.href = `player.html?storyId=${storyId}&audioUrl=${encodeURIComponent(audioUrl)}&title=${encodeURIComponent(title)}&thumbnail=${encodeURIComponent(thumbnail)}`;
                });
            });
        });
    </script>

    <!-- Audio player overlay -->
    <div class="audio-player-overlay hidden" id="audioPlayerOverlay">
        <div class="mini-player">
            <img id="miniCover" src="" alt="Now Playing" class="mini-cover">
            <div class="mini-info">
                <div class="mini-title" id="miniTitle">No track playing</div>
                <div class="mini-category" id="miniCategory">Select a story to play</div>
            </div>
            <div class="mini-controls">
                <button class="mini-control-btn" id="prevBtn">⏪</button>
                <button class="mini-control-btn" id="playPauseBtn">▶️</button>
                <button class="mini-control-btn" id="nextBtn">⏩</button>
            </div>
        </div>
    </div>

    <audio id="backgroundAudio" preload="none"></audio>

    <script>
        // Global variables for audio management
        let currentAudio = null;
        let isPlaying = false;
        let currentStoryId = null;
        let currentPosition = 0;
        let currentMiniPlayerVisible = false;
        let currentPlayingStory = null;

        // Initialize audio element
        const audio = document.getElementById('backgroundAudio');

        // Story card click handlers
        document.querySelectorAll('.story-card').forEach(card => {
            card.addEventListener('click', () => {
                const storyId = card.dataset.storyId;
                const audioUrl = card.dataset.audioUrl;
                const title = card.dataset.title;
                const thumbnail = card.dataset.thumbnail;
                
                // Navigate to player page with story details
                window.location.href = `player.html?storyId=${storyId}&audioUrl=${encodeURIComponent(audioUrl)}&title=${encodeURIComponent(title)}&thumbnail=${encodeURIComponent(thumbnail)}`;
            });
        });

        // Mini player controls
        document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
        document.getElementById('prevBtn').addEventListener('click', () => seekAudio(-10));
        document.getElementById('nextBtn').addEventListener('click', () => seekAudio(10));

        function togglePlayPause() {
            if (isPlaying) {
                pauseAudio();
            } else {
                playAudio();
            }
        }

        function playAudio() {
            if (currentAudio) {
                currentAudio.play();
                isPlaying = true;
                updateMiniPlayerButton();
            }
        }

        function pauseAudio() {
            if (currentAudio) {
                currentAudio.pause();
                isPlaying = false;
                updateMiniPlayerButton();
            }
        }

        function seekAudio(seconds) {
            if (currentAudio) {
                currentAudio.currentTime = Math.max(0, Math.min(currentAudio.duration || 0, currentAudio.currentTime + seconds));
            }
        }

        function updateMiniPlayerButton() {
            const btn = document.getElementById('playPauseBtn');
            btn.textContent = isPlaying ? '⏸️' : '▶️';
        }

        // Show/hide mini player
        function showMiniPlayer(title, category, thumbnail) {
            document.getElementById('miniTitle').textContent = title;
            document.getElementById('miniCategory').textContent = category;
            document.getElementById('miniCover').src = thumbnail;
            document.getElementById('audioPlayerOverlay').classList.remove('hidden');
            currentMiniPlayerVisible = true;
        }

        function hideMiniPlayer() {
            document.getElementById('audioPlayerOverlay').classList.add('hidden');
            currentMiniPlayerVisible = false;
        }

        // Audio event listeners
        audio.addEventListener('timeupdate', updateProgress);
        audio.addEventListener('ended', () => {
            isPlaying = false;
            updateMiniPlayerButton();
        });

        function updateProgress() {
            // Could add progress bar updates here if needed
        }

        // Handle page visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && isPlaying) {
                // Store current position when navigating away
                currentPosition = audio.currentTime;
            }
        });

        // Initialize mini player state
        updateMiniPlayerButton();

        // Listen for messages from player.html
        window.addEventListener('message', function(event) {
            if (event.data.type === 'audioUpdate') {
                const { isPlaying: playerIsPlaying, title, category, thumbnail } = event.data;
                
                if (playerIsPlaying) {
                    showMiniPlayer(title, category, thumbnail);
                    updateMiniPlayerButton();
                } else {
                    hideMiniPlayer();
                }
            }
        });
    </script>
</body>
</html>